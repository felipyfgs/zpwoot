# üìã Checklist de Migra√ß√£o para Clean Architecture

Este documento guia a reorganiza√ß√£o completa do projeto para seguir os princ√≠pios de **Clean Architecture** e **Hexagonal Architecture (Ports & Adapters)**.

---

## üéØ Objetivo

Garantir que o projeto tenha:
- ‚úÖ Separa√ß√£o clara de responsabilidades
- ‚úÖ Core independente de frameworks e infraestrutura
- ‚úÖ Interfaces bem definidas (Ports)
- ‚úÖ Adapters implementando as interfaces
- ‚úÖ Fluxo de depend√™ncias correto (sempre apontando para o Core)

---

## üìä Fase 0: Prepara√ß√£o e An√°lise

### 0.1 Mapeamento Inicial

- [ ] **Listar todos os arquivos `.go` do projeto**
  ```bash
  find internal -name "*.go" -type f | sort > files_inventory.txt
  ```

- [ ] **Identificar depend√™ncias externas usadas**
  - [ ] HTTP (chi, handlers, middleware)
  - [ ] Database (sqlx, postgres)
  - [ ] WhatsApp (whatsmeow)
  - [ ] Logger (zerolog)
  - [ ] Config (godotenv)
  - [ ] Outras: _______________

- [ ] **Criar backup do projeto**
  ```bash
  git checkout -b migration-clean-architecture
  git add .
  git commit -m "Backup antes da migra√ß√£o para Clean Architecture"
  ```

- [ ] **Ler documenta√ß√£o criada**
  - [ ] `internal/core/README.md`
  - [ ] `internal/core/ports/README.md`
  - [ ] `internal/core/CURRENT_STATE.md`

---

## üìÇ Fase 1: An√°lise de Arquivos por Camada

### 1.1 Analisar `internal/core/domain/`

Para cada arquivo em `domain/`:

**`domain/session/entity.go`**
- [ ] Verificar se cont√©m apenas:
  - [ ] Struct `Session` com campos de neg√≥cio
  - [ ] M√©todos de comportamento da entidade
  - [ ] Value Objects (ex: `Status`)
  - [ ] Sem depend√™ncias externas (apenas stdlib)
- [ ] **Decis√£o:** ‚úÖ Manter / ‚ùå Mover para: _______________

**`domain/session/repository.go`**
- [ ] Verificar se √© apenas interface (n√£o implementa√ß√£o)
- [ ] Verificar se m√©todos usam apenas tipos do dom√≠nio
- [ ] **Decis√£o:** ‚úÖ Manter / ‚ùå Mover para: _______________

**`domain/session/service.go`**
- [ ] Verificar se cont√©m apenas l√≥gica de neg√≥cio pura
- [ ] Verificar se depende apenas de `Repository` interface
- [ ] Verificar se n√£o tem depend√™ncias de adapters
- [ ] **Decis√£o:** ‚úÖ Manter / ‚ùå Mover para: _______________

**`domain/shared/errors.go`**
- [ ] Verificar se cont√©m apenas erros de dom√≠nio
- [ ] **Decis√£o:** ‚úÖ Manter / ‚ùå Mover para: _______________

### 1.2 Analisar `internal/core/application/`

**`application/dto/`**
- [ ] Listar todos os DTOs existentes:
  - [ ] `common.go` - Response, ErrorResponse, Pagination
  - [ ] `session.go` - CreateSessionRequest, SessionResponse, etc.
  - [ ] `message.go` - SendMessageRequest, MessageResponse, etc.
  - [ ] Outros: _______________

- [ ] Para cada DTO, verificar:
  - [ ] √â usado para comunica√ß√£o externa (API)?
  - [ ] Tem convers√£o de/para entidades de dom√≠nio?
  - [ ] **Decis√£o:** ‚úÖ Manter em `application/dto/` / ‚ùå Mover para: _______________

**`application/interfaces/`** ‚ö†Ô∏è **ATEN√á√ÉO: Deve ser movido para `ports/output/`**

- [ ] Listar todas as interfaces:
  - [ ] `whatsapp.go` - WhatsAppClient
  - [ ] `notification.go` - NotificationService
  - [ ] Outras: _______________

- [ ] Para cada interface, decidir:
  - [ ] √â uma depend√™ncia externa que o Core precisa?
  - [ ] Deve estar em `ports/output/`?
  - [ ] **A√ß√£o:** üîÑ Mover para `ports/output/`

**`application/usecase/`**

- [ ] Listar todos os use cases:
  - [ ] `session/create.go`
  - [ ] `session/connect.go`
  - [ ] `session/disconnect.go`
  - [ ] `session/logout.go`
  - [ ] `session/get.go`
  - [ ] `session/list.go`
  - [ ] `session/delete.go`
  - [ ] `session/qr.go`
  - [ ] `message/send.go`
  - [ ] `message/receive.go`
  - [ ] Outros: _______________

- [ ] Para cada use case, verificar:
  - [ ] Tem depend√™ncias de Domain Services?
  - [ ] Tem depend√™ncias de Ports (interfaces)?
  - [ ] N√£o tem depend√™ncias diretas de Adapters?
  - [ ] Retorna DTOs (n√£o entidades de dom√≠nio)?
  - [ ] **Decis√£o:** ‚úÖ Manter / ‚ùå Refatorar

**`application/validators/`**

- [ ] Listar validadores:
  - [ ] `session.go`
  - [ ] `message.go`
  - [ ] Outros: _______________

- [ ] Verificar se validam apenas entrada de API (n√£o regras de neg√≥cio)
- [ ] **Decis√£o:** ‚úÖ Manter / ‚ùå Mover para: _______________

### 1.3 Analisar `internal/core/ports/`

**Estado atual:**
- [ ] Diret√≥rio existe mas est√° vazio

**A√ß√µes necess√°rias:**
- [ ] Criar `internal/core/ports/output/`
- [ ] Criar `internal/core/ports/input/` (opcional)

---

## üîß Fase 2: Reorganiza√ß√£o de Ports

### 2.1 Criar estrutura de Ports

```bash
mkdir -p internal/core/ports/output
mkdir -p internal/core/ports/input  # opcional
```

- [ ] Estrutura criada

### 2.2 Mover interfaces para `ports/output/`

**WhatsApp Client:**
- [ ] Mover `application/interfaces/whatsapp.go` ‚Üí `ports/output/whatsapp.go`
  ```bash
  mv internal/core/application/interfaces/whatsapp.go internal/core/ports/output/whatsapp.go
  ```
- [ ] Atualizar package de `package interfaces` para `package output`
- [ ] Verificar se tipos relacionados foram movidos juntos:
  - [ ] `SessionStatus`
  - [ ] `QRCodeInfo`
  - [ ] `MessageResult`
  - [ ] `MediaData`
  - [ ] `Location`
  - [ ] `ContactInfo`
  - [ ] `WhatsAppError`

**Notification Service:**
- [ ] Mover `application/interfaces/notification.go` ‚Üí `ports/output/notification.go`
  ```bash
  mv internal/core/application/interfaces/notification.go internal/core/ports/output/notification.go
  ```
- [ ] Atualizar package de `package interfaces` para `package output`
- [ ] Verificar se tipos relacionados foram movidos juntos:
  - [ ] `WebhookEvent`
  - [ ] `MessageEvent`
  - [ ] `SessionEvent`
  - [ ] `QRCodeEvent`
  - [ ] Constantes de eventos

### 2.3 Criar Logger Port (NOVO)

- [ ] Criar arquivo `internal/core/ports/output/logger.go`
- [ ] Definir interface `Logger` com m√©todos:
  - [ ] `Debug(msg string, fields ...Field)`
  - [ ] `Info(msg string, fields ...Field)`
  - [ ] `Warn(msg string, fields ...Field)`
  - [ ] `Error(msg string, fields ...Field)`
  - [ ] `Fatal(msg string, fields ...Field)`
  - [ ] `WithContext(ctx context.Context) Logger`
  - [ ] `WithField(key string, value interface{}) Logger`
  - [ ] `WithFields(fields map[string]interface{}) Logger`
  - [ ] `WithError(err error) Logger`
  - [ ] `WithComponent(component string) Logger`
  - [ ] `WithRequestID(requestID string) Logger`
  - [ ] `WithSessionID(sessionID string) Logger`
- [ ] Definir struct `Field` para campos estruturados

### 2.4 Criar Input Ports (OPCIONAL)

Se decidir criar interfaces para use cases:

- [ ] Criar `internal/core/ports/input/session.go`
  - [ ] Interface `SessionCreator`
  - [ ] Interface `SessionConnector`
  - [ ] Interface `SessionDisconnector`
  - [ ] Interface `SessionDeleter`
  - [ ] Interface `SessionGetter`
  - [ ] Interface `SessionLister`
  - [ ] Interface `QRCodeManager`

- [ ] Criar `internal/core/ports/input/message.go`
  - [ ] Interface `MessageSender`
  - [ ] Interface `MessageReceiver`

### 2.5 Remover diret√≥rio vazio

- [ ] Verificar se `application/interfaces/` est√° vazio
- [ ] Remover diret√≥rio:
  ```bash
  rmdir internal/core/application/interfaces
  ```

---

## üîÑ Fase 3: Atualizar Imports

### 3.1 Atualizar imports em Use Cases

Para cada use case em `application/usecase/`:

**`session/create.go`**
- [ ] Trocar `"zpwoot/internal/core/application/interfaces"` por `"zpwoot/internal/core/ports/output"`
- [ ] Trocar `interfaces.WhatsAppClient` por `output.WhatsAppClient`
- [ ] Trocar `interfaces.NotificationService` por `output.NotificationService`
- [ ] Verificar compila√ß√£o: `go build ./internal/core/application/usecase/session/`

**`session/connect.go`**
- [ ] Atualizar imports
- [ ] Verificar compila√ß√£o

**`session/disconnect.go`**
- [ ] Atualizar imports
- [ ] Verificar compila√ß√£o

**`session/logout.go`**
- [ ] Atualizar imports
- [ ] Verificar compila√ß√£o

**`session/get.go`**
- [ ] Atualizar imports
- [ ] Verificar compila√ß√£o

**`session/list.go`**
- [ ] Atualizar imports
- [ ] Verificar compila√ß√£o

**`session/delete.go`**
- [ ] Atualizar imports
- [ ] Verificar compila√ß√£o

**`session/qr.go`**
- [ ] Atualizar imports
- [ ] Verificar compila√ß√£o

**`message/send.go`**
- [ ] Atualizar imports
- [ ] Verificar compila√ß√£o

**`message/receive.go`**
- [ ] Atualizar imports
- [ ] Verificar compila√ß√£o

### 3.2 Atualizar imports em Container

**`internal/container/container.go`**
- [ ] Trocar `"zpwoot/internal/core/application/interfaces"` por `"zpwoot/internal/core/ports/output"`
- [ ] Trocar `interfaces.WhatsAppClient` por `output.WhatsAppClient`
- [ ] Trocar `interfaces.NotificationService` por `output.NotificationService`
- [ ] Verificar compila√ß√£o: `go build ./internal/container/`

### 3.3 Atualizar imports em Adapters

**`adapters/waclient/whatsapp_adapter.go`**
- [ ] Trocar `"zpwoot/internal/core/application/interfaces"` por `"zpwoot/internal/core/ports/output"`
- [ ] Trocar `interfaces.SessionStatus` por `output.SessionStatus`
- [ ] Trocar `interfaces.QRCodeInfo` por `output.QRCodeInfo`
- [ ] Trocar `interfaces.MessageResult` por `output.MessageResult`
- [ ] Verificar compila√ß√£o: `go build ./internal/adapters/waclient/`

**`adapters/http/router/router.go`**
- [ ] Verificar se usa interfaces
- [ ] Atualizar imports se necess√°rio
- [ ] Verificar compila√ß√£o: `go build ./internal/adapters/http/`

### 3.4 Atualizar imports automaticamente (alternativa)

- [ ] Executar substitui√ß√£o em massa:
  ```bash
  find internal -name "*.go" -type f -exec sed -i 's|zpwoot/internal/core/application/interfaces|zpwoot/internal/core/ports/output|g' {} \;
  ```
- [ ] Executar `gofmt` para formatar:
  ```bash
  gofmt -w internal/
  ```

---

## üèóÔ∏è Fase 4: Implementar Logger Adapter

### 4.1 Criar Logger Adapter

- [ ] Criar arquivo `internal/adapters/logger/logger_adapter.go`
- [ ] Implementar struct `LoggerAdapter` que implementa `output.Logger`
- [ ] Wrapper para `*logger.Logger` existente
- [ ] Implementar todos os m√©todos da interface

### 4.2 Atualizar Container para usar Logger Port

**`internal/container/container.go`**
- [ ] Trocar `logger *logger.Logger` por `logger output.Logger`
- [ ] Atualizar inicializa√ß√£o para usar `LoggerAdapter`
- [ ] Verificar compila√ß√£o

---

## ‚úÖ Fase 5: Verifica√ß√£o e Testes

### 5.1 Verificar Compila√ß√£o

- [ ] Compilar todo o projeto:
  ```bash
  go build ./...
  ```
- [ ] Resolver erros de compila√ß√£o (se houver)

### 5.2 Executar go mod tidy

- [ ] Limpar depend√™ncias:
  ```bash
  go mod tidy
  ```

### 5.3 Executar Testes

- [ ] Executar todos os testes:
  ```bash
  go test ./...
  ```
- [ ] Corrigir testes quebrados (se houver)

### 5.4 Verificar Estrutura Final

- [ ] Executar tree para verificar estrutura:
  ```bash
  tree internal/core -L 3
  ```

- [ ] Estrutura esperada:
  ```
  internal/core/
  ‚îú‚îÄ‚îÄ domain/
  ‚îÇ   ‚îú‚îÄ‚îÄ session/
  ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ entity.go
  ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repository.go
  ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ service.go
  ‚îÇ   ‚îî‚îÄ‚îÄ shared/
  ‚îÇ       ‚îî‚îÄ‚îÄ errors.go
  ‚îú‚îÄ‚îÄ application/
  ‚îÇ   ‚îú‚îÄ‚îÄ dto/
  ‚îÇ   ‚îú‚îÄ‚îÄ usecase/
  ‚îÇ   ‚îî‚îÄ‚îÄ validators/
  ‚îî‚îÄ‚îÄ ports/
      ‚îú‚îÄ‚îÄ output/
      ‚îÇ   ‚îú‚îÄ‚îÄ whatsapp.go
      ‚îÇ   ‚îú‚îÄ‚îÄ notification.go
      ‚îÇ   ‚îî‚îÄ‚îÄ logger.go
      ‚îî‚îÄ‚îÄ input/  (opcional)
  ```

---

## üìù Fase 6: Documenta√ß√£o

### 6.1 Atualizar ARCHITECTURE.md

- [ ] Atualizar diagrama de camadas
- [ ] Atualizar se√ß√£o de Ports
- [ ] Adicionar exemplos de uso

### 6.2 Atualizar README.md do projeto

- [ ] Atualizar se√ß√£o de arquitetura
- [ ] Adicionar link para `internal/core/README.md`

### 6.3 Criar README por camada (se n√£o existir)

- [ ] `internal/adapters/README.md`
- [ ] `internal/config/README.md`
- [ ] `internal/container/README.md`

---

## üéØ Fase 7: Valida√ß√£o Final

### 7.1 Checklist de Qualidade

- [ ] **Domain n√£o depende de nada** (exceto stdlib)
- [ ] **Application depende apenas de Domain e Ports**
- [ ] **Ports define apenas interfaces** (sem implementa√ß√µes)
- [ ] **Adapters implementam Ports**
- [ ] **Fluxo de depend√™ncias est√° correto** (sempre para dentro)
- [ ] **N√£o h√° imports com alias desnecess√°rios**
- [ ] **Cada arquivo tem responsabilidade √∫nica**
- [ ] **Nomes de arquivos s√£o consistentes**

### 7.2 Code Review

- [ ] Revisar cada arquivo movido
- [ ] Verificar se l√≥gica de neg√≥cio n√£o vazou para adapters
- [ ] Verificar se adapters n√£o t√™m l√≥gica de neg√≥cio
- [ ] Verificar se DTOs s√£o usados corretamente

### 7.3 Executar Aplica√ß√£o

- [ ] Iniciar aplica√ß√£o:
  ```bash
  make run
  ```
- [ ] Testar endpoints principais:
  - [ ] POST /sessions (criar sess√£o)
  - [ ] GET /sessions (listar sess√µes)
  - [ ] POST /sessions/:id/connect (conectar)
  - [ ] GET /sessions/:id/qr (obter QR)
  - [ ] POST /messages/send (enviar mensagem)

---

## üöÄ Fase 8: Commit e Deploy

### 8.1 Commit das Mudan√ßas

- [ ] Adicionar arquivos:
  ```bash
  git add .
  ```
- [ ] Commit:
  ```bash
  git commit -m "refactor: migrate to Clean Architecture with Ports & Adapters

  - Move interfaces to internal/core/ports/output/
  - Create Logger port interface
  - Update all imports to use ports
  - Remove application/interfaces/ directory
  - Update documentation"
  ```

### 8.2 Merge para main

- [ ] Criar Pull Request
- [ ] Code Review
- [ ] Merge para main

---

## üìä M√©tricas de Sucesso

Ap√≥s a migra√ß√£o, o projeto deve ter:

- ‚úÖ **0 depend√™ncias** do Domain para Application/Ports/Adapters
- ‚úÖ **0 depend√™ncias** do Application para Adapters
- ‚úÖ **100% das interfaces** em Ports
- ‚úÖ **100% dos adapters** implementando interfaces de Ports
- ‚úÖ **0 imports com alias** desnecess√°rios
- ‚úÖ **Compila√ß√£o sem erros**
- ‚úÖ **Testes passando**
- ‚úÖ **Aplica√ß√£o funcionando**

---

## üÜò Troubleshooting

### Erro: "undefined: interfaces.WhatsAppClient"

**Solu√ß√£o:** Atualizar import de `interfaces` para `output`

### Erro: "cannot use ... as type output.Logger"

**Solu√ß√£o:** Criar LoggerAdapter que implementa a interface

### Erro: "import cycle not allowed"

**Solu√ß√£o:** Verificar se Domain n√£o est√° importando Application

---

## ‚úÖ Conclus√£o

Ao completar esta checklist, o projeto estar√°:
- ‚úÖ Seguindo Clean Architecture
- ‚úÖ Com Ports & Adapters bem definidos
- ‚úÖ Test√°vel e manuten√≠vel
- ‚úÖ Independente de frameworks
- ‚úÖ Pronto para crescer

**Data de conclus√£o:** _______________  
**Respons√°vel:** _______________

